<% if current_user.role == 'Admin_High'%>
<h1>Listing series_description_maps</h1>

<table class="tabular">
  <tr>
    <th>Id</th>
    <th>Series description type</th>
    <th>Series description</th>
    <th>Count by Scan Protocol</th>
    <% if current_user.role == 'Admin_High'%>
    <th></th>
    <th></th>
    <th></th>
    <%end%>
  </tr>

<% @series_description_maps.each do |series_description_map| %>
  <tr>
    <td><%= series_description_map.id %></td>
    <td><%= if !series_description_map.series_description_type_id.blank? 
	        SeriesDescriptionType.find(series_description_map.series_description_type_id).series_description_type 
	   end%></td>
    <td><%= series_description_map.series_description %></td>
    <td><% sdsps = SeriesDescriptionScanProcedure.where("series_description_scan_procedures.series_description_id in ( select series_descriptions.id from series_descriptions where trim(long_description) in (?) )",series_description_map.series_description.strip)
        v_sp_cnt_array = Array.new
         sdsps.each do |sdsp|
               v_sp = ScanProcedure.find(sdsp.scan_procedure_id)
               v_sp_cnt_array.push(v_sp.codename+"  cnt ="+(sdsp.scan_count).to_s)
          end %>
          <%= v_sp_cnt_array.join(", ") %>
    </td>
    <% if current_user.role == 'Admin_High'%>
    <td><%= link_to 'Show', series_description_map %></td>
    <td><%= link_to 'Edit', edit_series_description_map_path(series_description_map) %></td>
    <td><%= link_to 'Destroy', series_description_map, :confirm => 'Are you sure?', :method => :delete %></td>
    <%end%>
  </tr>
<% end %>
</table>

<br />

<%= link_to 'New Series description map', new_series_description_map_path %>
<% else %>
  Your <%= current_user.role %> role does not allow access. 
<% end %>